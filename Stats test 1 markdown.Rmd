---
title: "Stats Test 1"
output: html_notebook
---

Load relevant packages:
```{r}
library(pacman)
p_load(tidyverse, haven, magrittr, readxl, labelled, psych, janitor, class, caret, vcd, e1071, readr, stringr, knitr, kableExtra, broom, boot, gmodels, glmnet, MASS, leaps, Metrics, ISLR, randomForest, tree, gbm, car)
```

Load relevant data
Convert conviction data from long to wide
Combine conviction data with delinquency data:
```{r}
delinquent <- read_spss("../statstest_1/data/Cambridge_delinquency.sav")
conviction <- read_spss("../statstest_1/data/conviction_data.sav")

wide_conviction <- spread(data = conviction, key = agecat, value = convicted)

icpsr_seq_id_number <- 1:411
delinquent$icpsr_seq_id_number <- icpsr_seq_id_number
join_delinquent <- full_join(delinquent, wide_conviction, by = "icpsr_seq_id_number")
```
Create new data frame with potential outcome variables:
Select pariticipant ID number, "Number of juvenile convictions", "Number of adult convictions", and "Number of overall convictions" to begin the new data 
Rename ID number (PID), number of juvenile convictions (njuv_convict), number of adult convictions (nadult_convict), and number of overall convictions.
Recode variables so that they're on comparable scales:
0 = no convictions
1 = 1 conviction
2 = 2 or 3 convictions
3 = 4 or more convictions
Check that recoding is correct

Check correlation of potential outcome variables with pairs panel, using Spearman's rho (rs) for ordinal data.
```{r}
criminality1 <- dplyr::select(join_delinquent, PID = icpsr_seq_id_number, njuv_convict = v28, nadult_convict = v29, nconvict = v30)

criminality2 <- dplyr::select(criminality1, PID, njuv_convict, nadult_convict, nconvict)
criminality2$njuv_convict <- recode(criminality2$njuv_convict, "1=0; 2=1; 3=2; 4=3")
criminality2$nadult_convict <- recode(criminality2$nadult_convict, "1=0; 2=1; 3=2; 4=3")
criminality2$nconvict <- recode(criminality2$nconvict, "1=0; 2=1; 3:4=2; 5:6=3")

describe(criminality1)
describe(criminality2)

pairs.panels(criminality2, method = "spearman")
```
We see that the mean, median, minimum, and maximum values of juvenile and adult conviction decrease by eaxtly one unit from criminality1 to criminality2, the standard deviations, number of participants, and range remain constant, as do estimates of skew, kurtosis, and standard error - This confirms that the recode was executed according to plan. Changes occur in the third variable (number of overall convictions) between data sets, because some of the levels were collapsed (to mirror the levels in the first two variables).

From the correlation matrix we see that there is only a moderate correlation between number of juvenile and adult convictions (rs = .54) indicating that not all convicted juveniles go on to adult conviction. Number of juvenile convictions predict number of overall convictions less strongly than number of adult convictions does (rs = .77 and rs = .90 respectively), indicating that the biggest influence on overall conviction is conviction in adulthood. Thus we conclude that not all juvenile convicts continue with criminality into adulthood (at least to the same degree), and the subsample that have a higher number of convictions in adulthood are slightly more representative of those who have higher level of convictions overall (criminality overall spikes in adulthood).
Thus is is useful to consider 2 models - 1) predictors that lead to juvenile criminality (and which go on to predict adult criminality to a moderate degree), and 2) predictors that lead to criminality in adulthood (which predicts overall criminality to a high degree).
-----------------------------

Next, we consider predictor variables for our primary outcomes (juvenile and adult criminality)
I am interested in what parent-child relationship variables predict criminality in the boys. There is extensive literature on the realtionship between child/adult outcomes and relational factors such as attachment style, early separations, and discipline. It is of interest which parent-child relational variables predict criminality as a juvenile, and as an adult, respectively. For the purposes of this model I will only consider primary relational processes (e.g.: separations, discipline), and not secondary relational processes (e.g.: unhappiness of father/mother, which may spill over into their relationship with their son). Furthermore, I will only consider dichotemous, ordinal or continuous variables (or those that can be recoded as such)

The following factors are selected for consideration:

Ages 8-9: Discipline of father or mother (v59, v60), discipline quality of father & mother (v 62 & v63), Interest in children by father (v90), maternal and paternal attitude (v99 & v 118), physical neglect of boy (v123), praise by parents (v124), rules of parents (v132), broken home before age 10 (v134), separations up to 5 from father or mother or parents (v139, v140 & v141), separations before 10 from father or mother or parents (v144, v 145 & v 146) , temporary separations up to age 5 from father or mother or parents (v148, v149, v150), temporary separations up to age 10 from father or mother or parents (v151, v152 & v 153), vigilence of parents (v159)
Ages 10-11: Attitude of father combined or mother combined (v178 & v179), authoratarianism of parents combined (v180), maternal and paternal attitude (v227 & v248),  P. A. S. father and mother authoratarian (v249 & v250), P. A. S. mother underconcerned (v251), supervision by parents (v274)
Ages 12-13: Parental approval of boy (v416), broken home before 15 (v425)
Ages 16-17: Who boy is living with (v495)
Ages 18-19: Natural parents alive or dead (v626), Living circumstances (parent/foster or other; v627), living preferences (v628), agreement with mother and father (v629 & v630), relationships with parents combined (v791)
Ages 21-22: Age left home (v814)
All new variable names end with a record of the boys age at the time of that round of data collection. THus "8y" indicates that the data was collected dueing the "ages 8-9" round. Some variables (e.g.: supervision_parents_score) was reported during a different round (e.g.: "ages 10 - 11"), but is actually an amalgamation of scores collected during an earlier round (e.g.: "ages 8 - 9"). In these cases they are labelled to indicate the time of raw score collection (e.g."8y"), not the time that it was amalgamated and reported (e.g.: "10y"), as no new information was collected (it is just data wrangling by the researchers) .
Only the variables collected before age 17 can be used as predictors of juvenile delinquency, and all variables can be used as predcitors of adult delinquency
```{r}
predictor_variables.dat <- dplyr::select(join_delinquent, 
                                         PID = icpsr_seq_id_number,
                              discipline_father_8y = v59, discipline_mother_8y = v60, discipline_quality_father_8y = v62, discipline_quality_mother_8y = v63,           father_interest_8y = v90, maternal_attitude_8y = v99, paternal_attitude_8y = v118,              neglected_8y = v123, parent_praise_8y = v124, parent_rules_8y = v132, permanent_sep_parent_8y = v134, over1mo_sep_father_under5y = v139, over1mo_sep_mother_under5y = v140, over1mo_sep_parent_under5y = v141, over1mo_sep_father_under10y = v144, over1mo_sep_mother_under10y = v145, over1mo_sep_parent_under10y = v146, temp_sep_father_under5y = v148, temp_sep_mother_under5y = v149, temp_sep_parent_under5y = v150, temp_sep_father_under10y = v151, temp_sep_mother_under10y = v152, temp_sep_parent_under10y = v153, parent_vigilence_8y = v159,
                             attitude_father_score_8y = v178, attitude_mother_score_8y = v179, pas_authoritarianism_parents_10y = v180, maternal_attitude_10y = v227, paternal_attitude_10y = v248, pas_authoritarianism_father_10y = v249, pas_authoritarianism_mother_10y = v250,pas_underconcerned_mother_10y = v251, supervision_parents_score_8y = v274,
                             parent_approval_12y = v416, permanent_sep_parent_12y = v425,
                             live_parents_home_16y = v495,
                             parents_alive_18y = v626, live_parentsorfoster_home_16y = v625, want_live_parents_home_18y = v628, agreement_mother_18y = v629, agreement_father_18y = v630, harmony_parents_score_18y = v791,
                             age_left_home_21y = v814)
```
Next, we need to recode the variables so that they are amenable to analysis (see attached codebook for detailed recoding)
```{r}

```

